((function(){var a,b;b=typeof exports!="undefined"&&exports!==null?exports:this,b.d3hg=a=b.d3hg||{},a.graph=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;i={},f={},o=[],k=[],p=(b?b.shapes:void 0)||{},e=null,l=0,m=0,d=function(a){var b,c,d,e,g;c=Object.create(a),c.x=c.x||0,c.y=c.y||0,o.push(c),c.id&&(i[c.id]=a);if(a["class"]){g=c["class"].split(" ");for(d=0,e=g.length;d<e;d++)b=g[d],f[b]||(f[b]=[]),f[b].push(c)}return l=Math.max(l,c.x),m=Math.max(m,c.y)},g=function(a){var b,c,d;b=a[0],c=a.slice(1);if(b==="#"){d=i[c];if(d)return[d]}return b==="."?f[c]||[]:[]},c=function(a,b,c){var d;return d=g(a).map(function(a){return g(b).map(function(b){return{source:a,target:b,"class":c}})}),k.push.apply(k,d3.merge(d))},h={link:function(a,b){return c(a,b),h},links:function(a){return arguments.length?(k=a,h):k},node:function(a){return d(a),h},nodes:function(a){var b,c,e;if(!arguments.length)return o;o=[],i={},f={};for(c=0,e=a.length;c<e;c++)b=a[c],d(b);return h},draw:function(b,c){return function(d){var f,g,i,j,k,n,o,q,r,s,t,u,v,w;o=d3.scale.linear().domain([0,l+1]).range([0,b]),q=d3.scale.linear().domain([0,m+1]).range([0,c]),e=d.append("g").attr("class","graph").attr("width",b).attr("height",c),e.append("rect").attr("width",b).attr("height",c),f=d3.svg.diagonal().projection(function(a){return[o(a.x),q(a.y)]}),e.selectAll("path").data(h.links()).enter().append("path").attr("class",function(a){return(a["class"]||"")+" link"}).attr("d",f).attr("fill","none"),e.selectAll("g.node").data(h.nodes()).enter().append("g").attr("class",function(a){return(a["class"]||"")+" node"}).attr("id",function(a){return a.id}).attr("transform",function(a){return"translate("+o(a.x)+","+q(a.y)+")"});for(r=0,t=p.length;r<t;r++){v=p[r],j=v.selector,k=v.shape,i=v.opts,n=a.stencils,w=k.split(".");for(s=0,u=w.length;s<u;s++)g=w[s],n=n[g];e.selectAll(j).call(n,i)}return e}}};if(b){u=b.nodes||[];for(q=0,s=u.length;q<s;q++)n=u[q],d(n);v=b.links||[];for(r=0,t=v.length;r<t;r++)j=v[r],c(j.source,j.target,j["class"])}return h},b=typeof exports!="undefined"&&exports!==null?exports:this,b.d3hg=a=b.d3hg||{},a.stencils={attr:function(a,b){var c,d,e;e=[];for(c in b)d=b[c],e.push(a.attr(c,d));return e},dot:function(a,b){return a.append("circle").attr("r",b.r||10).attr("stroke-width",3).attr("stroke","#fff").attr("fill",b.fill||"#2d578b")},text:function(a,b){var c,d,e,f,g,h,i,j;e=a.append("text").attr("x",f=b.x||0).attr("y",g=b.y||0).attr("text-anchor",b["text-anchor"]||"middle").attr("width",b.width).attr("height",b.height),b.rotation&&e.attr("transform","rotate("+b.rotation+" "+f+" "+g+")"),i=b.text.split("\n"),j=[];for(c=0,h=i.length;c<h;c++)d=i[c],j.push(e.append("tspan").attr("x",0).attr("dy",c*1.1+"em").text(d));return j}}})).call(this);